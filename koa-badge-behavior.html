<!--
@license
Copyright (c) 2015 Team King of App. All rights reserved.
This code may only be used under the MIT license.
-->

<link rel="import" href="../polymer/polymer.html">

<script>
  Polymer.KoaBadgeBehaviorImpl = {
    hostAttributes: {
      role: 'status',
      tabindex: 0
    },

    properties: {
      /**
       * The id of the element that the badge is anchored to. This element must
       * be a sibling of the badge.
       */
      for: {
        type: String,
        observer: '_forChanged'
      },

      /**
       * The label displayed in the badge. The label is centered, and ideally
       * should have very few characters.
       */
      label: {
        type: String,
        observer: '_labelChanged'
      }
    },

    attached: function() {
      this._updateTarget();
    },

    _forChanged: function() {
      // The first time the property is set is before the badge is attached,
      // which means we're not ready to position it yet.
      if (!this.isAttached) {
        return;
      }
      this._updateTarget();
    },

    _labelChanged: function() {
      this.setAttribute('aria-label', this.label);
    },

    _updateTarget: function() {
      this._target = this.target;
      this.async(this.notifyResize, 1);
    },

    /**
     * Returns the target element that this badge is anchored to. It is
     * either the element given by the `for` attribute, or the immediate parent
     * of the badge.
     */
    get target () {
      var parentNode = Polymer.dom(this).parentNode;
      // If the parentNode is a document fragment, then we need to use the host.
      var ownerRoot = Polymer.dom(this).getOwnerRoot();
      var target;

      if (this.for) {
        target = Polymer.dom(ownerRoot).querySelector('#' + this.for);
      } else {
        target = parentNode.nodeType == Node.DOCUMENT_FRAGMENT_NODE ?
            ownerRoot.host : parentNode;
      }

      return target;
    }
  };

  Polymer.KoaBadgeBehavior = [
    Polymer.KoaBadgeBehaviorImpl
  ];
</script>
